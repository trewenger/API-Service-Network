{% extends "base.html" %}

{% block title %}How To Guide - Retail Inventory Manager{% endblock %}

{% block content %}
<div class="min-h-screen p-6 bg-gray-100">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">How To Guide</h1>
                    <p class="text-gray-600 mt-1">Learn how to use the Retail Inventory Manager</p>
                </div>
                <div>
                    <a href="{{ url_for('index') }}"
                       class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded transition">
                        Back to App
                    </a>
                </div>
            </div>
        </div>

        <!-- Table of Contents -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-blue-900 mb-4">Table of Contents</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-blue-700">
                <a href="#overview" class="hover:underline">1. System Overview</a>
                <a href="#modes" class="hover:underline">2. Inventory Modes</a>
                <a href="#adding-skus" class="hover:underline">3. Adding SKUs</a>
                <a href="#editing-skus" class="hover:underline">4. Editing SKUs</a>
                <a href="#sync" class="hover:underline">5. Sync Functionality</a>
                <a href="#sales-check" class="hover:underline">6. Sales Check</a>
                <a href="#settings" class="hover:underline">7. Settings</a>
                <a href="#errors" class="hover:underline">8. Error Management</a>
            </div>
        </div>

        <!-- Content Sections -->

        <!-- 1. System Overview -->
        <div id="overview" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">1. System Overview</h2>
            <p class="text-gray-700 mb-3">
                The Retail Inventory Manager is a webapp/web-tool that controls inventory levels in Fishbowl (Retail Website Inventory Location),
                which is then used to control available inventory on e-commerce site. It manages available quantities for website sales and ensures accurate
                stock levels.
            </p>
            <div class="bg-gray-50 border rounded p-4">
                <h3 class="font-semibold text-gray-800 mb-2">Key Features:</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-1">
                    <li>Manual and Automated inventory management modes</li>
                    <li>Real-time synchronization with Fishbowl</li>
                    <li>Sales order tracking and quantity updates</li>
                    <li>SKU management with search functionality</li>
                    <li>Error logging and email notifications</li>
                </ul>
            </div>
        </div>

        <!-- 2. Inventory Modes -->
        <div id="modes" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">2. Inventory Modes</h2>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-blue-600 mb-2">Manual Mode</h3>
                <p class="text-gray-700 mb-2">
                    In Manual mode, you have full control over inventory quantities. You manually set the
                    available quantity for the desired SKU, and the system tracks sales to decrement quantities.
                    Any SKU not defined in the manual mode will default to automatic mode to manage it's inventory levels. 
                </p>
                <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mt-2">
                    <span class="font-semibold">Use Case:</span> When you want to limit or inflate website inventory
                    to specific quantities (e.g., Black Friday sales or reserving certain inventories).
                </div>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-green-600 mb-2">Automated Mode</h3>
                <p class="text-gray-700 mb-2">
                    In Automated mode, the system automatically syncs inventory quantities in Fishbowl's
                    "Retail Website Inventory" location for all SKUs. By default, all serialized SKUs and receivers have a default quantity of
                    '100' as there is currently no stock buffer for these parts. For all other SKUs, automated mode determines the available inventory
                    by considering current on hand levels, supply orders (work orders), and demand orders (sales orders) within a relevant time
                    frame to determine the available quantity. 
                </p>
                <div class="bg-green-50 border border-green-200 rounded p-3 mt-2">
                    <span class="font-semibold">Use Case:</span> When you want the website to always reflect
                    current Fishbowl inventory levels without manual intervention. This method prioritizes delivering
                    perfect on-time performance, meaning if we cannot fulfill a sale within that products lead time, 
                    then it will not be available on the site. 
                </div>
            </div>

            <div class="bg-gray-50 border rounded p-4">
                <h3 class="font-semibold text-gray-800 mb-2">Switching Modes:</h3>
                <p class="text-gray-700">
                    Use the toggle switch in the header to switch between Manual and Automated modes.
                    The interface will change to show mode-specific controls.
                </p>
            </div>
        </div>

        <!-- 3. Adding SKUs -->
        <div id="adding-skus" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">3. Adding SKUs (Manual Mode)</h2>

            <div class="space-y-3">
                <div class="flex items-start gap-3">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">1</span>
                    <p class="text-gray-700">Click the <span class="font-semibold text-blue-600">"+ Add SKU"</span> button</p>
                </div>

                <div class="flex items-start gap-3">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">2</span>
                    <p class="text-gray-700">Enter the SKU (must exist in Fishbowl - system validates this)</p>
                </div>

                <div class="flex items-start gap-3">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">3</span>
                    <p class="text-gray-700">Enter the product description</p>
                </div>

                <div class="flex items-start gap-3">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">4</span>
                    <p class="text-gray-700">Set the <span class="font-semibold">Available Quantity</span> (how many units you want available for website sales)</p>
                </div>

                <div class="flex items-start gap-3">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">5</span>
                    <p class="text-gray-700">Optionally add notes for reference</p>
                </div>

                <div class="flex items-start gap-3">
                    <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">6</span>
                    <p class="text-gray-700">Click <span class="font-semibold">"Save"</span></p>
                </div>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded p-4 mt-4">
                <span class="font-semibold">Important:</span> The system automatically checks Fishbowl to verify
                the SKU exists and determines if it's a serialized product. Serialized products have special handling (insert or removal of serial numbers).
            </div>
        </div>

        <!-- 4. Editing SKUs -->
        <div id="editing-skus" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">4. Editing & Deleting SKUs</h2>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Editing a SKU:</h3>
                <div class="space-y-2">
                    <p class="text-gray-700">Click the <span class="text-blue-600 font-semibold">"Edit"</span> button next to any SKU</p>
                    <p class="text-gray-700">Update the product name, available quantity, or notes</p>
                    <p class="text-gray-700">Click <span class="font-semibold">"Save"</span> to apply changes</p>
                </div>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Deleting a SKU:</h3>
                <p class="text-gray-700">Click the <span class="text-red-600 font-semibold">"Delete"</span> button and confirm the deletion</p>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Searching SKUs:</h3>
                <p class="text-gray-700">Use the search box to filter SKUs by SKU code or product name</p>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded p-4">
                <span class="font-semibold">Tip:</span> The table shows color-coded quantities:
                <ul class="list-disc list-inside mt-2 space-y-1">
                    <li><span class="text-red-600 font-bold">Red</span> = Sold out (0 quantity)</li>
                    <li><span class="text-yellow-600 font-bold">Yellow</span> = Low stock (1-10 units)</li>
                    <li><span class="text-green-600 font-bold">Green</span> = In stock (11+ units)</li>
                </ul>
            </div>
        </div>

        <!-- 5. Sync Functionality -->
        <div id="sync" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">5. Sync Functionality</h2>

            <p class="text-gray-700 mb-4">
                The Sync process updates the "Retail Website Inventory" location in Fishbowl with the
                current available quantities from this system. This process calculates the values and then cycles them into Fishbowl.
            </p>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Automatic Syncing:</h3>
                <p class="text-gray-700">
                    The system automatically syncs at the set interval (default: 5 minutes).
                    This applies to both Manual and Automated modes.
                </p>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Manual Syncing:</h3>
                <p class="text-gray-700">
                    Click the <span class="font-semibold text-green-600">"Sync Now"</span> button
                    in Settings to trigger an immediate sync. This does not change the next scheduled automatic sync time.
                </p>
            </div>

            <div class="bg-gray-50 border rounded p-4">
                <h3 class="font-semibold text-gray-800 mb-2">What Happens During Sync:</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-1">
                    <li><span class="font-semibold">Manual Mode:</span> Runs a sales check to get the most recent sales data and then performs a normal sync. However, 
                    SKUs defined in the manual mode section will override the automatic sync quantities. </li>
                    <li><span class="font-semibold">Automated Mode:</span> Updates all SKUs according to the automated mode formula with no overrides. </li>
                </ul>
            </div>
        </div>

        <!-- 6. Sales Check -->
        <div id="sales-check" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">6. Sales Check (Manual Mode Only)</h2>

            <p class="text-gray-700 mb-4">
                The Sales Check process monitors Fishbowl for new sales orders and decrements
                available quantities accordingly. For example, if you define 'R0001' to have 100 available, and later a retail sales order is 
                created for 1 of them, the new quantity will be 99. 
            </p>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">How It Works:</h3>
                <div class="space-y-2">
                    <div class="flex items-start gap-3">
                        <span class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">1</span>
                        <p class="text-gray-700">System checks Fishbowl for new sales orders at the set interval</p>
                    </div>

                    <div class="flex items-start gap-3">
                        <span class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">2</span>
                        <p class="text-gray-700">When a sale is detected, it decrements the available quantity you defined manually</p>
                    </div>

                    <div class="flex items-start gap-3">
                        <span class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">3</span>
                        <p class="text-gray-700">Increments the "Orders" counter for that SKU (for reference)</p>
                    </div>

                    <div class="flex items-start gap-3">
                        <span class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mt-0.5">4</span>
                        <p class="text-gray-700">Updates the "Last Sales Check" timestamp</p>
                    </div>
                </div>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
                <span class="font-semibold">Note:</span> In Manual Mode, both Sales Check and Sync run automatically.
                The Sync process also triggers a Sales Check, so quantities stay accurate.
            </div>
        </div>

        <!-- 7. Settings -->
        <div id="settings" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">7. Settings</h2>

            <p class="text-gray-700 mb-4">
                Click the Settings section header to expand/collapse the settings panel.
            </p>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Sync Interval:</h3>
                <p class="text-gray-700 mb-2">
                    Controls how often the automatic sync runs (applies to both modes).
                </p>
                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                    <li>Default: 5 minutes</li>
                    <li>Range: 1-180 minutes</li>
                    <li>Changes apply immediately without server restart</li>
                </ul>
                <div class="bg-red-50 border border-red-200 rounded p-3 mt-2">
                    <span class="font-semibold">Warning:</span> Values outside 3-5 minutes may cause
                    unexpected behavior with website inventory functionality.
                </div>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Sales Check Interval (Manual Mode):</h3>
                <p class="text-gray-700 mb-2">
                    Controls how often the system checks for new sales orders in Manual Mode.
                </p>
                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                    <li>Default: 5 minutes</li>
                    <li>Range: 1-180 minutes</li>
                    <li>Only active in Manual Mode</li>
                </ul>
            </div>
        </div>

        <!-- 8. Error Management -->
        <div id="errors" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">8. Error & Logging Management</h2>

            <p class="text-gray-700 mb-4">
                The system logs all errors and logs. New Errors automatically trigger an email notifications when it occurs.
            </p>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Viewing Errors & Logs:</h3>
                <p class="text-gray-700">
                    Expand the Settings panel to see the "Recent Errors" and "Recent Logs" sections. The count badges
                    show the number of unresolved logs for each.
                </p>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Error/Log Details:</h3>
                <p class="text-gray-700 mb-2">Click the <span class="text-blue-600 font-bold">ⓘ</span> button to see detailed information including:</p>
                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                    <li>Error type and message</li>
                    <li>Source of the error</li>
                    <li>Timestamp</li>
                    <li>User context</li>
                    <li>Additional technical details</li>
                </ul>
                <p class="text-gray-700 mb-2"> or in the case of an audit log:</p>
                <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                    <li>Action type and message</li>
                    <li>Timestamp</li>
                    <li>Deleted and updated items will display their previous value</li>
                    <li>Created items will display the new value</li>
                </ul>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Resolving Errors:</h3>
                <p class="text-gray-700">
                    Click the <span class="text-green-600 font-bold">✓</span> button to mark an error as resolved.
                    This helps track which errors have been addressed. It also enables error emails to be sent for the same kind
                    of error again. 
                </p>
            </div>

            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Clearing Errors:</h3>
                <p class="text-gray-700">
                    Use the <span class="font-semibold">"Clear All"</span> button to remove all entries in either log.
                    This action cannot be undone.
                </p>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded p-4">
                <span class="font-semibold">Auto Refresh:</span> The logs automatically refreshes every minute
                to show the latest errors without requiring a page reload.
            </div>
        </div>

        <!-- Important Notes -->
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-red-800 mb-3">Important Notes</h2>
            <ul class="list-disc list-inside text-red-800 space-y-2">
                <li>
                    <span class="font-semibold">Serialized Products:</span> If you override the quantity
                    for a serialized product in Manual Mode, set it back to a quantity ≥ 100 and resync
                    before switching to Automated Mode.
                </li>
                <li>
                    <span class="font-semibold">Data Refresh:</span> The page automatically refreshes SKU
                    data every minute, so you'll see updates without manually reloading the page.
                </li>
                <li>
                    <span class="font-semibold">Authentication:</span> All pages require login. Sessions
                    will timeout after inactivity.
                </li>
            </ul>
        </div>

        <!-- Back Button -->
        <div class="text-center mb-6">
            <a href="{{ url_for('index') }}"
               class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition text-lg inline-block">
                Back to App
            </a>
        </div>
    </div>
</div>
{% endblock %}
